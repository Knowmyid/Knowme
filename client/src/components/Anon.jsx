import React, { useState, useEffect } from 'react';
import { init, prove, generateArgs, artifactUrls } from '@anon-aadhaar/core';

const AnonAadhaarProofGenerator = () => {
    const [proof, setProof] = useState(null);

    useEffect(() => {
        const initializeAnonAadhaar = async () => {
            const anonAadhaarInitArgs = {
                wasmURL: artifactUrls.V1.wasm,
                zkeyURL: artifactUrls.V1.zkey,
                vkeyURL: artifactUrls.V1.vk,
                isWebEnv: true,
            };

            await init(anonAadhaarInitArgs);
        };

        initializeAnonAadhaar();
    }, []);

    useEffect(() => {
        const generateProof = async () => {
            const qrData ='3592693987192632209911539540018163671338872270640219491589028777834197829561354452736604411718379844800793694735863128728028083922563775761472466840901822534409829473140774177268976461494646159652030728830541590517315510886173234780853351323743370861970396400294229315447740749446152150954521756211651258473292692600438502655794598409118310841564463023291833501557101900974605537632265751949565479906514978302956028002293999311192817295805061915466137112577175166529695684470117929959067664560510076140514978934312305166150483043538128374950935018122677617417524861481404121913072668847896461742834105145718106169606374003440844480306929748344828941229236490989740838082797348778803020741205520626182927400277564591035851399709267821229870486070817200190836928208150066824695640959594146000146779434736108342069714430031929554473029851717904229204320732943706908018971663309388010770525011047705610488689103371786668898225059836005164253912442341870214311053651992927052903378410217303322781985979582474336745491134916426647155144354183930445278995508134725143500836497676631012838816937559319657219758492423861615540606333450967683152066398027050876254835201835121472374751270569248350309276824045100082744899896052522733867246887290815478209140554983242671216481793551491935450530728371314693199743464677355285839754369703912838667579097063879531520531914705239505867332119615136343425621367690520534205106940830328809783614421086065847240224833087494544611215571771022410266163503115914715110769119688540790620003701493280515569180410484047175646162168111639104443361762677850071316743295736982077877733013117672970476913266700303775606465069614089231682456947020930433047452938674048848506753888131499798168247256732444967995260459623601535605486863118116003482637722357519193000433097692865532630141577817309266672397034451889639512190265400288535253335807478559473847620902161292470263591475380920713009846987764080384734325598260022987759412297875168506358722928211235860368438632409243392191079084841217022946234980912721449563873207294950263002362160172160006862214584930628733316771855178629581043051863442953155713354953310829679374496050515884551156537768156359417467630141765119605981537144853876598685659306064387040176316765171097865890741662011317100543762958490294087122422676352928237915040688722377339288876285120684648611629174987095550373079946928802944894070475724533532842974090280034771473011650863771153902698958418849157032138167340250336250704915357416162361130615948332734747931721253971702720258180310294404220390948469983906733069389101066264432403702639848228787691522238274779804395716590432882345357857059037867798761007683577459831927704007635526196810776764604208387293984991625787578133601728919598857614447885234085464451317519839101531187766397595196708668819910581133435426757205882644041520653409570744897265184304837237908992522699096355660847344303940380216598104924138284045700570459145866611086390942619997003006476742036775552244926171083844637817151264631104651198840917106252163405408702023859467517090305736704';

            // Fetch the certificate file from a local path
            const certificateFile = '../assets/uidai_auth_prod.cer'

            const nullifierSeed = 1234;

            const args = await generateArgs({
                QRData: qrData,
                certificateFile,
                nullifierSeed,
            });

            const anonAadhaarCore = await prove(args);

            setProof(anonAadhaarCore);
        };

        generateProof();
    }, []);

    return (
        <div>
            <h1>Anon Aadhaar Proof Generator</h1>
            {proof ? (
                <div>
                    <h2>Proof Generated:</h2>
                    <pre>{JSON.stringify(proof, null, 2)}</pre>
                </div>
            ) : (
                <p>Generating proof...</p>
            )}
        </div>
    );
};

export default AnonAadhaarProofGenerator;
